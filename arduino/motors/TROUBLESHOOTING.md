# Устранение неполадок драйвера JYQD_YL02D

## Основная проблема: Safety Start Function

Согласно документации драйвера, после включения питания **управление скоростью блокируется** до выполнения процедуры разблокировки.

### Решение:
1. После включения питания установите скорость в 0
2. Примените тормоз (например, 50% - значение 128 из 255)
3. Подождите 200-300 мс
4. Снимите тормоз (установите в 0)
5. Теперь можно управлять скоростью

## Проверка подключений

### 1. Питание драйвера (36V)
- **P+** → положительный полюс блока питания 36V
- **P-** → отрицательный полюс блока питания 36V
- ⚠️ **Внимание**: Блок питания должен выдавать стабильные 36V при токе до 10A

### 2. Датчики Холла (Hall Port)
- **1Ha, 1Hb, 1Hc** → три датчика Холла мотора
- **5V** → питание датчиков (драйвер выдает 5V)
- **GND** → общая земля
- ⚠️ **Важно**: Мотор должен иметь датчики Холла с углом 120° (не 60° или 180°)

### 3. Фазы мотора (Power Port)
- **1MA, 1MB, 1MC** → три фазы мотора
- ⚠️ **Важно**: Провода не должны быть слишком длинными (может быть помехи)

### 4. Управление от Arduino (Control Port)
- **1VR** (PIN 9) → управление скоростью (PWM, 0-255 = 0-5V)
- **1Z/F** (PIN 7) → направление (HIGH = вперед, LOW = назад)
- **1EL** (PIN 10) → тормоз (PWM, 0-255 = 0-5V)
- **1M** (PIN 4) → энкодер (выход частоты вращения)
- **GND** → **ОБЯЗАТЕЛЬНО** подключить общую землю между Arduino и драйвером!
- **5V** → можно использовать для питания Arduino (но лучше использовать отдельный источник)

## Потенциометр на блоке питания

Потенциометр на блоке питания 36V, скорее всего, регулирует **выходное напряжение**. 
- Проверьте, что он установлен на максимальное значение (36V)
- Если напряжение ниже, мотор может не запускаться или работать некорректно

## Важные моменты из документации

1. **Регулировка скорости**: 
   - Аналоговое напряжение 0-5V (или 0-2.5V для линейной регулировки)
   - При использовании PWM нужна общая земля

2. **Направление вращения**:
   - Подключение к 5V или оставление в плавающем состоянии = одно направление
   - Подключение к GND = другое направление

3. **Тормоз**:
   - Регенеративное торможение (возвращает энергию в систему)
   - ⚠️ **НЕ тестируйте тормоз с регулируемым блоком питания** - может повредить драйвер!

4. **Теплоотвод**:
   - При длительной работе с большим током нужен теплоотвод
   - Проверьте температуру драйвера

## Последовательность запуска

1. Подключите все провода
2. Включите блок питания (36V)
3. Загрузите код в Arduino
4. Код автоматически выполнит разблокировку Safety Start
5. Мотор должен начать работать

## Диагностика

Используйте файл `motor_diagnostics.ino` для пошаговой проверки:
- Проверка направления вращения
- Проверка тормоза
- Проверка энкодера
- Проверка всех функций

## Возможные проблемы

### Мотор не вращается вообще
1. Проверьте питание драйвера (36V)
2. Проверьте подключение датчиков Холла
3. Проверьте общую землю (GND) между Arduino и драйвером
4. Проверьте, что выполняется разблокировка Safety Start
5. Проверьте потенциометр на блоке питания (должен быть на максимуме)

### Мотор дергается или работает нестабильно
1. Проверьте подключение датчиков Холла (возможно, перепутаны провода)
2. Проверьте подключение фаз мотора
3. Проверьте длину проводов (не должны быть слишком длинными)

### Мотор вращался один раз, потом перестал
1. Возможно, повреждены провода после накручивания на ось
2. Проверьте целостность всех соединений
3. Проверьте датчики Холла (могут быть повреждены)
4. Проверьте драйвер на наличие повреждений

## Рекомендации по коду

1. **Всегда сначала снимайте тормоз**, затем меняйте направление, затем устанавливайте скорость
2. **Плавно меняйте скорость** (не резко с 0 до максимума)
3. **Перед остановкой** сначала уменьшите скорость до 0, затем примените тормоз
4. Используйте задержки между командами (50-100 мс) для стабилизации
